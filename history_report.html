<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“Š é”€å”®æ±‡æ€»æŠ¥å‘Š</title>
    <style>
        body { font-family: 'Helvetica Neue', Arial, sans-serif; background-color: #f4f4f4; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); }
        h2 { color: #a04000; border-bottom: 2px solid #ff9933; padding-bottom: 5px; margin-top: 0; }
        .summary-box { background-color: #e6ffec; border: 2px solid #5cb85c; padding: 15px; border-radius: 6px; margin-bottom: 20px; text-align: center; }
        .summary-box p { margin: 5px 0; font-size: 18px; font-weight: bold; }
        /* è´§å¸æ˜¾ç¤ºæ ·å¼ */
        .summary-box span { font-size: 28px; color: #a04000; margin-left: 10px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 14px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background-color: #f2f2f2; }
        .total-row { background-color: #fff3cd; font-weight: bold; }
        .action-btn { background-color: #007bff; color: white; padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; margin-top: 10px; }
        .action-btn:hover { background-color: #0056b3; }
    </style>
</head>
<body>

    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h2>ğŸ“Š é”€å”®æ±‡æ€»æŠ¥å‘Š</h2>
            <a href="order_system.html">è¿”å›è®¢å•ç³»ç»Ÿ</a>
        </div>

        <div class="summary-box">
            <p>æ€»è®¢å•æ•°: <span id="total-orders">0</span> ç¬”</p>
            <p>ç´¯è®¡æ€»æ”¶å…¥: <span id="total-revenue">0</span> Ks</p>
        </div>

        <button id="clear-history-btn" class="action-btn" style="background-color: #d9534f;">æ¸…ç©ºå†å²è®°å½• (æ…é‡æ“ä½œ)</button>

        <h3>è®¢å•è¯¦æƒ…</h3>
        <table id="history-table">
            <thead>
                <tr>
                    <th>åºå·</th>
                    <th>æ¡Œå·/è®¢å•å</th>
                    <th>æ€»é‡‘é¢ (Ks)</th>
                    <th>æ—¶é—´</th>
                    <th>è®¢å•è¯¦æƒ…</th>
                </tr>
            </thead>
            <tbody>
                </tbody>
        </table>
        
    </div>

    <script>
        const HISTORY_KEY = 'bbq_history_records';
        const totalOrdersSpan = document.getElementById('total-orders');
        const totalRevenueSpan = document.getElementById('total-revenue');
        const historyTableBody = document.querySelector('#history-table tbody');
        const clearHistoryBtn = document.getElementById('clear-history-btn');

        let historyRecords = [];

        /**
         * ä»æœ¬åœ°å­˜å‚¨åŠ è½½å†å²è®°å½•
         */
        function loadHistory() {
            const data = localStorage.getItem(HISTORY_KEY);
            historyRecords = data ? JSON.parse(data) : [];
        }

        /**
         * æ ¼å¼åŒ–è®¢å•è¯¦æƒ…ä¸ºå¯è¯»å­—ç¬¦ä¸²
         */
        function formatOrderDetails(items) {
            let details = [];
            for (const itemId in items) {
                const item = items[itemId];
                details.push(`${item.itemData.name} x ${item.quantity}`);
            }
            return details.join(', ');
        }

        /**
         * æ¸²æŸ“å†å²è®°å½•è¡¨æ ¼å’Œæ±‡æ€»æ•°æ®
         */
        function renderHistoryReport() {
            loadHistory();
            historyTableBody.innerHTML = '';
            let totalRevenue = 0;

            if (historyRecords.length === 0) {
                const row = historyTableBody.insertRow();
                row.innerHTML = `<td colspan="5" style="text-align: center; color: #888;">æš‚æ— å†å²è®¢å•è®°å½•ã€‚</td>`;
            } else {
                // ç¡®ä¿æŒ‰æœ€æ–°æ—¶é—´æ’åº
                historyRecords.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

                historyRecords.forEach((record, index) => {
                    totalRevenue += record.totalAmount;

                    const row = historyTableBody.insertRow();
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${record.customer}</td> 
                        <td style="color: #d9534f; font-weight: bold;">${record.totalAmount.toFixed(0)} Ks</td>
                        <td>${new Date(record.timestamp).toLocaleString('zh-CN', { hour12: false })}</td>
                        <td>${formatOrderDetails(record.items)}</td>
                    `;
                });
            }

            // æ›´æ–°æ±‡æ€»æ•°æ® (æ€»é‡‘é¢å–æ•´)
            totalOrdersSpan.textContent = historyRecords.length;
            totalRevenueSpan.textContent = totalRevenue.toFixed(0);
        }

        /**
         * æ¸…ç©ºå†å²è®°å½• (æ°¸ä¹…åˆ é™¤)
         */
        function clearAllHistory() {
            if (confirm('è­¦å‘Šï¼šæ‚¨ç¡®å®šè¦æ°¸ä¹…æ¸…é™¤æ‰€æœ‰å†å²é”€å”®è®°å½•å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚')) {
                localStorage.removeItem(HISTORY_KEY);
                historyRecords = [];
                renderHistoryReport();
                alert('å†å²è®°å½•å·²æ¸…ç©ºã€‚');
            }
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            renderHistoryReport();
            clearHistoryBtn.addEventListener('click', clearAllHistory);
        });
    </script>
</body>
</html>